//
// GPIO_7seg : counting from 0 to 9999 and display on 7-segment LEDs
//
#include <stdio.h>
#include "NUC100Series.h"
#include "MCU_init.h"
#include "SYS_init.h"
#include "Seven_Segment.h"
#include "Scankey.h"
int lastpressed = 0;
// display an integer on four 7-segment LEDs
void Display_7seg(uint16_t value)
{
  uint8_t digit;
	digit = value / 1000;
	CloseSevenSegment();
	ShowSevenSegment(3,digit);
	CLK_SysTickDelay(5000);
			
	value = value - digit * 1000;
	digit = value / 100;
	CloseSevenSegment();
	ShowSevenSegment(2,digit);
	CLK_SysTickDelay(5000);

	value = value - digit * 100;
	digit = value / 10;
	CloseSevenSegment();
	ShowSevenSegment(1,digit);
	CLK_SysTickDelay(5000);

	value = value - digit * 10;
	digit = value;
	CloseSevenSegment();
	ShowSevenSegment(0,digit);
	CLK_SysTickDelay(5000);
}

void Display_Pattern(int *pattern)
{
	int pos;
	for (pos=0; pos<4; pos++) {
			CloseSevenSegment();
			ShowSevenSegment(pos, pattern[pos]);
			CLK_SysTickDelay(500);
	}
}

void marquee_shift_right(int *pattern)
{
	int temp = 0,i;
	temp = pattern[0];
	for(i=0;i<3;i++)
		pattern[i] = pattern[i+1];
	pattern[3] = temp;
}

void marquee_shift_left(int *pattern)
{
	int temp = 0,i;
	temp = pattern[3];
	for(i=3;i>0;i--)
		pattern[i] = pattern[i-1];
	pattern[0] = temp;
}

void marquee_reset(int *pattern)
{
	pattern[0] = 10;
	pattern[1] = 17;
	pattern[2] = 0;
	pattern[3] = 16;
}

void mode(int i,int counter)
{
	int a = 0;
	static int hola[] = {10,17,0,16};
	Display_Pattern(hola);
	if(counter>=500)
	{
		if(i==6)
			marquee_shift_right(hola);
		else if(i==4)
			marquee_shift_left(hola);
		else if(i==8)
			marquee_reset(hola);
		else if(i==5)
		{
		}
	}
}

int main(void)
{
	uint32_t i =0,counter = 0;
	
    SYS_Init();
    OpenSevenSegment();
		OpenKeyPad();
	

 	while(1) 
	{
		//init();
	  //Display_7seg(i);		// display i on 7-segment display	
		//i++;
		//if (i>9999) i=0;	
		i = ScanKey();
		if(i!=0)
			lastpressed = i;
		mode(lastpressed,counter);
		counter++;
		if(counter>500)
			counter = 0;
		
		//Display_7seg(1500);
	}	
}

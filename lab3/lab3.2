//
// GPIO_7seg : counting from 0 to 9999 and display on 7-segment LEDs
//
#include <stdio.h>
#include "NUC100Series.h"
#include "MCU_init.h"
#include "SYS_init.h"
#include "Seven_Segment.h"
int lastpressed = 0;
// display an integer on four 7-segment LEDs
void Display_7seg(uint16_t value)
{
  uint8_t digit;
	digit = value / 1000;
	CloseSevenSegment();
	ShowSevenSegment(3,digit);
	CLK_SysTickDelay(5000);
			
	value = value - digit * 1000;
	digit = value / 100;
	CloseSevenSegment();
	ShowSevenSegment(2,digit);
	CLK_SysTickDelay(5000);

	value = value - digit * 100;
	digit = value / 10;
	CloseSevenSegment();
	ShowSevenSegment(1,digit);
	CLK_SysTickDelay(5000);

	value = value - digit * 10;
	digit = value;
	CloseSevenSegment();
	ShowSevenSegment(0,digit);
	CLK_SysTickDelay(5000);
}

void init()
{
	CloseSevenSegment();
	ShowSevenSegment(0,10);
	CLK_SysTickDelay(5000);
	
	CloseSevenSegment();
	ShowSevenSegment(1,17);
	CLK_SysTickDelay(5000);
	
	CloseSevenSegment();
	ShowSevenSegment(2,0);
	CLK_SysTickDelay(5000);
	
	CloseSevenSegment();
	ShowSevenSegment(3,16);
	CLK_SysTickDelay(5000);
}
void Display_Pattern(int *pattern)
{
	int pos;
	for (pos=0; pos<4; pos++) {
			CloseSevenSegment();
			ShowSevenSegment(pos, pattern[pos]);
			CLK_SysTickDelay(500);
	}
}

void mode(int i)
{
	int a = 0,temp,key = 0;
	static int hola[] = {10,17,0,16};
	int re[] = {10,17,0,16};
	if(i==8)
	{
		for(a=0;a<4;a++)
		{
			hola[a] = re[a];
		}
		Display_Pattern(hola);
		key = ScanKey();
	}
	else if(i==6)
	{
		for(a=0;a<100;a++)
		{
			if(key!=0)
			{
				lastpressed = key;
				return;
			}
			Display_Pattern(hola);
		}
		
		temp = hola[0];
    for (a=0; a<3; a++) {
        hola[a] = hola[a+1];
    }
    hola[3] = temp;
	}
	else if(i==4)
	{
		for(a=0;a<100;a++)
		{
			if(key!=0)
			{
				lastpressed = key;
				return;
			}
			Display_Pattern(hola);
		}
		
		temp = hola[3];
    for (a=3; a>0; a--) {
        hola[a] = hola[a-1];
    }
    hola[0] = temp;
		key = ScanKey();
	}
	else if(i==5)
	{
		Display_Pattern(hola);
		key = ScanKey();
		if(key!=0)
		{
			lastpressed = key;
			return;
		}
	}
	CLK_SysTickDelay(5000);
}

int main(void)
{
	uint32_t i =0;
	
    SYS_Init();
    OpenSevenSegment();
		OpenKeyPad();
	

 	while(1) 
	{
		//init();
	  //Display_7seg(i);		// display i on 7-segment display	
		//i++;
		//if (i>9999) i=0;	
		i = ScanKey();
		if(i!=0)
			lastpressed = i;
		mode(lastpressed);
		//CLK_SysTickLongDelay(100000);
		//Display_7seg(1500);
	}	
}

//
// GPIO_7seg : counting from 0 to 9999 and display on 7-segment LEDs
//
#include <stdio.h>
#include <stdlib.h>
#include "NUC100Series.h"
#include "MCU_init.h"
#include "SYS_init.h"
#include "Seven_Segment.h"
#include "Scankey.h"
//display an integer on four 7-segment LEDs
void Display_7seg(uint16_t value)
{
  	uint8_t digit;
	digit = value / 1000;
	CloseSevenSegment();
	ShowSevenSegment(3,digit);
	CLK_SysTickDelay(5000);
			
	value = value - digit * 1000;
	digit = value / 100;
	CloseSevenSegment();
	ShowSevenSegment(2,digit);
	CLK_SysTickDelay(5000);

	value = value - digit * 100;
	digit = value / 10;
	CloseSevenSegment();
	ShowSevenSegment(1,digit);
	CLK_SysTickDelay(5000);

	value = value - digit * 10;
	digit = value;
	CloseSevenSegment();
	ShowSevenSegment(0,digit);
	CLK_SysTickDelay(5000);
}
void display_two_digit(int value,int remain)
{
	int digit;
	if(remain==-1)
		CloseSevenSegment();
	else
	{
		ShowSevenSegment(3,remain);
		CLK_SysTickDelay(5000);
	}
	digit = value / 10;
	CloseSevenSegment();
	ShowSevenSegment(1,digit);
	CLK_SysTickDelay(5000);

	value = value - digit * 10;
	digit = value;
	CloseSevenSegment();
	ShowSevenSegment(0,digit);
	CLK_SysTickDelay(5000);
}

void mode(int key,int number)
{
	int value;
	if(key == 9)
		CloseSevenSegment();
	else if(key == 3)
		display_two_digit(number,-1);
	else if(key == 1)
	{
		value = number%2;
		display_two_digit(number,value);
	}
	else if(key == 4)
	{
		value = number%3;
		display_two_digit(number,value);
	}
	else if(key == 7)
	{
		value = number%5;
		display_two_digit(number,value);
	}
	CloseSevenSegment();
}

int main(void)
{
	int i =0,count = 0,lastpressed = 0,key,value = 0;
	
    SYS_Init();
    OpenSevenSegment();
	OpenKeyPad();
	

 	while(1) 
	{
		key = ScanKey();
		if(key!=0)
		{
			lastpressed = key;
			srand(count++);
			if(key==3)
				value = rand()%100;
		}
		mode(lastpressed,value);
		CLK_SysTickDelay(5000);
	}	
}
